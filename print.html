<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Criando e empacotando uma aplicação CLI</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Uma demonstração do tooling envolvido na criação de uma aplicação para linha de comando e o envio para o crates.io. Pretendo falar sobre o uso do Cargo, as bibliotecas mais comuns para parsear argumentos (clap, structopt, thunder e docopt) e tratamento de erros com failure.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body class="light">
        <!-- Provide site root to javascript -->
        <script type="text/javascript">var path_to_root = "";</script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { } 
            if (theme === null || theme === undefined) { theme = 'light'; }
            document.body.className = theme;
            document.querySelector('html').className = theme + ' js';
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <ol class="chapter"><li><a href="1-introducao/1-0-introducao.html"><strong aria-hidden="true">1.</strong> Introdução</a></li><li><ol class="section"><li><a href="1-introducao/1-1-working-groups/1-1-0-working-groups.html"><strong aria-hidden="true">1.1.</strong> Domain Working Groups de 2018</a></li><li><ol class="section"><li><a href="1-introducao/1-1-working-groups/1-1-1-cli-wg.html"><strong aria-hidden="true">1.1.1.</strong> CLI WG</a></li></ol></li><li><a href="1-introducao/1-2-o-que-e-cli.html"><strong aria-hidden="true">1.2.</strong> O que é uma CLI?</a></li><li><a href="1-introducao/1-3-0-o-que-nao-e-cli.html"><strong aria-hidden="true">1.3.</strong> O que não é uma CLI?</a></li><li><ol class="section"><li><a href="1-introducao/1-3-1-tui.html"><strong aria-hidden="true">1.3.1.</strong> TUI</a></li><li><a href="1-introducao/1-3-2-gui.html"><strong aria-hidden="true">1.3.2.</strong> GUI</a></li></ol></li></ol></li><li><a href="2-parsing-de-argumentos/2-0-parsing-de-argumentos.html"><strong aria-hidden="true">2.</strong> Parsing de Argumentos</a></li><li><ol class="section"><li><a href="2-parsing-de-argumentos/2-1-clap/2-1-0-clap.html"><strong aria-hidden="true">2.1.</strong> CLAP</a></li><li><ol class="section"><li><a href="2-parsing-de-argumentos/2-1-clap/2-1-1-builder-pattern.html"><strong aria-hidden="true">2.1.1.</strong> Método 1: Builder Pattern</a></li><li><a href="2-parsing-de-argumentos/2-1-clap/2-1-2-usage-string.html"><strong aria-hidden="true">2.1.2.</strong> Método 2: Usage String</a></li><li><a href="2-parsing-de-argumentos/2-1-clap/2-1-3-yaml.html"><strong aria-hidden="true">2.1.3.</strong> Método 3: YAML</a></li><li><a href="2-parsing-de-argumentos/2-1-clap/2-1-4-macro.html"><strong aria-hidden="true">2.1.4.</strong> Método 4: Macro</a></li><li><a href="2-parsing-de-argumentos/2-1-clap/2-1-5-extracao-dos-argumentos.html"><strong aria-hidden="true">2.1.5.</strong> Extração dos Argumentos</a></li></ol></li><li><a href="2-parsing-de-argumentos/2-2-structopt/2-2-0-structopt.html"><strong aria-hidden="true">2.2.</strong> StructOpt</a></li><li><ol class="section"><li><a href="2-parsing-de-argumentos/2-2-structopt/2-2-1-struct.html"><strong aria-hidden="true">2.2.1.</strong> Struct</a></li><li><a href="2-parsing-de-argumentos/2-2-structopt/2-2-2-enum.html"><strong aria-hidden="true">2.2.2.</strong> Enum</a></li></ol></li><li><a href="2-parsing-de-argumentos/2-3-thunder.html"><strong aria-hidden="true">2.3.</strong> Thunder</a></li><li><a href="2-parsing-de-argumentos/2-4-docopt.html"><strong aria-hidden="true">2.4.</strong> Docopt</a></li><li><a href="2-parsing-de-argumentos/2-5-std.html"><strong aria-hidden="true">2.5.</strong> std</a></li></ol></li><li><a href="3-tratamento-de-erros/3-0-tratamento-de-erros.html"><strong aria-hidden="true">3.</strong> Tratamento de Erros</a></li><li><ol class="section"><li><a href="3-tratamento-de-erros/3-1-unwrap-expect.html"><strong aria-hidden="true">3.1.</strong> unwrap/expect</a></li><li><a href="3-tratamento-de-erros/3-2-no-main.html"><strong aria-hidden="true">3.2.</strong> ? no main</a></li><li><a href="3-tratamento-de-erros/3-3-lidando-com-varios-tipos-de-erros.html"><strong aria-hidden="true">3.3.</strong> Lidando com vários tipos de erros</a></li><li><a href="3-tratamento-de-erros/3-4-failure.html"><strong aria-hidden="true">3.4.</strong> Failure</a></li><li><a href="3-tratamento-de-erros/3-5-exitfailure.html"><strong aria-hidden="true">3.5.</strong> ExitFailure</a></li><li><a href="3-tratamento-de-erros/3-6-human-panic.html"><strong aria-hidden="true">3.6.</strong> human-panic</a></li></ol></li><li><a href="4-testes.html"><strong aria-hidden="true">4.</strong> Testes</a></li><li><a href="5-empacotamento/5-0-empacotamento.html"><strong aria-hidden="true">5.</strong> Empacotamento</a></li><li><ol class="section"><li><a href="5-empacotamento/5-1-cargo.html"><strong aria-hidden="true">5.1.</strong> Cargo</a></li><li><a href="5-empacotamento/5-2-compilacao-cruzada.html"><strong aria-hidden="true">5.2.</strong> Compilação Cruzada</a></li><li><a href="5-empacotamento/5-3-geracao-de-pacotes.html"><strong aria-hidden="true">5.3.</strong> Geração de Pacotes</a></li></ol></li><li><a href="6-documentacao.html"><strong aria-hidden="true">6.</strong> Documentação</a></li><li><a href="7-exemplos/7-0-exemplos.html"><strong aria-hidden="true">7.</strong> Exemplos de sucesso</a></li><li><ol class="section"><li><a href="7-exemplos/7-1-exa.html"><strong aria-hidden="true">7.1.</strong> exa</a></li><li><a href="7-exemplos/7-2-ripgrep.html"><strong aria-hidden="true">7.2.</strong> ripgrep</a></li><li><a href="7-exemplos/7-3-fd.html"><strong aria-hidden="true">7.3.</strong> fd</a></li><li><a href="7-exemplos/7-4-bat.html"><strong aria-hidden="true">7.4.</strong> bat</a></li><li><a href="7-exemplos/7-5-tokei.html"><strong aria-hidden="true">7.5.</strong> tokei</a></li><li><a href="7-exemplos/7-6-hyperfine.html"><strong aria-hidden="true">7.6.</strong> hyperfine</a></li><li><a href="7-exemplos/7-7-durt.html"><strong aria-hidden="true">7.7.</strong> durt</a></li></ol></li><li><a href="8-fim.html"><strong aria-hidden="true">8.</strong> Fim</a></li></ol>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light <span class="default">(default)</span></button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">Criando e empacotando uma aplicação CLI</h1> 

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <a class="header" href="#criando-e-empacotando-uma-aplicação-cli" id="criando-e-empacotando-uma-aplicação-cli"><h1>Criando e empacotando uma aplicação CLI</h1></a>
<pre><pre class="playpen"><code class="language-rust">fn main() {
    println!(&quot;Olá, rustáceos!&quot;);
}
</code></pre></pre>
<ul>
<li>Slides criados com <a href="https://github.com/rust-lang-nursery/mdbook">mdBook</a></li>
<li>Disponíveis em <a href="https://cauebs.github.io/rust-cli-talk">cauebs.github.io/rust-cli-talk</a></li>
</ul>
<a class="header" href="#domain-working-groups-de-2018" id="domain-working-groups-de-2018"><h1>Domain Working Groups de 2018</h1></a>
<p><em>Fonte: <a href="https://internals.rust-lang.org/t/announcing-the-2018-domain-working-groups/6737">internals.rust-lang.org/t/announcing-the-2018-domain-working-groups/6737</a></em></p>
<a class="header" href="#serviços-de-rede" id="serviços-de-rede"><h2>Serviços de rede</h2></a>
<p>Com foco na experiência de ponta a ponta para código tanto síncrono quanto assíncrono, em coordenação com o crescente ecossistema desse espaço.</p>
<a class="header" href="#webassembly" id="webassembly"><h2>WebAssembly</h2></a>
<p>Com foco na experiência de ponta a ponta de embutir código Rust em bibliotecas e apps em JS via WebAssembly.</p>
<a class="header" href="#aplicações-cli" id="aplicações-cli"><h2>Aplicações CLI</h2></a>
<p>Com foco na experiência de ponta a ponta de escrever aplicações CLI, pequenas ou grande, em Rust.</p>
<a class="header" href="#dispositivos-embarcados" id="dispositivos-embarcados"><h2>Dispositivos embarcados</h2></a>
<p>Com foco na experiência de ponta a ponta de usar Rust em ambientes com recursos limitados e plataformas não tradicionais.</p>
<a class="header" href="#cli-working-group" id="cli-working-group"><h1>CLI Working Group</h1></a>
<a class="header" href="#a-hrefhttpsgithubcomrust-lang-nurserycli-wggithubcomrust-lang-nurserycli-wga" id="a-hrefhttpsgithubcomrust-lang-nurserycli-wggithubcomrust-lang-nurserycli-wga"><h2><a href="https://github.com/rust-lang-nursery/cli-wg/">github.com/rust-lang-nursery/cli-wg</a></h2></a>
<p><img src="1-1-1-cli-wg.png" alt="cli-wg/issues" /></p>
<a class="header" href="#o-que-é-uma-cli" id="o-que-é-uma-cli"><h1>O que é uma CLI?</h1></a>
<p><strong>C</strong>ommand <strong>L</strong>ine <strong>I</strong>nterface</p>
<ul>
<li>Inicia em um terminal</li>
<li>Aceita configuração de várias fontes, e.g.:
<ul>
<li>Argumentos de linha de comando</li>
<li>Variáveis de ambiente</li>
<li>Arquivos de configuração</li>
</ul>
</li>
<li>Executa até terminar, com pouca ou nenhuma intervenção do usuário</li>
<li>Aceita dados de entrada da <code>stdin</code>, de arquivos ou da rede</li>
<li>Executa operações sobre alguma entrada de acordo com a configuração especificada</li>
<li>Se comunica através das saídas padrão (arquivos, rede, <code>stdout</code>, <code>stderr</code>)</li>
</ul>
<a class="header" href="#o-que-não-é-uma-cli" id="o-que-não-é-uma-cli"><h1>O que <em>não</em> é uma CLI?</h1></a>
<a class="header" href="#o-que-não-é-uma-cli-1" id="o-que-não-é-uma-cli-1"><h1>O que <em>não</em> é uma CLI?</h1></a>
<a class="header" href="#uma-interface-textual-tui-usando-algo-como-ncurses" id="uma-interface-textual-tui-usando-algo-como-ncurses"><h2>Uma interface textual (TUI), usando algo como <code>ncurses</code></h2></a>
<p><img src="1-3-1-tui.png" alt="ncmpcpp, exemplo de TUI" /></p>
<a class="header" href="#o-que-não-é-uma-cli-2" id="o-que-não-é-uma-cli-2"><h1>O que <em>não</em> é uma CLI?</h1></a>
<a class="header" href="#uma-interface-gráfica-gui-usando-algo-como-qt-ou-gtk" id="uma-interface-gráfica-gui-usando-algo-como-qt-ou-gtk"><h2>Uma interface gráfica (GUI), usando algo como Qt ou GTK</h2></a>
<p><img src="1-3-2-gui.png" alt="pavucontrol, exemplo de GUI" /></p>
<a class="header" href="#parsing-de-argumentos" id="parsing-de-argumentos"><h1>Parsing de Argumentos</h1></a>
<a class="header" href="#objetivos" id="objetivos"><h2>Objetivos</h2></a>
<ul>
<li>Definir a interface</li>
<li>Impôr ao usuário</li>
<li>Apresentar documentação e mensagens de erro úteis</li>
</ul>
<a class="header" href="#abordagens" id="abordagens"><h2>Abordagens</h2></a>
<ul>
<li>CLAP</li>
<li>StructOpt</li>
<li>Thunder</li>
<li>Docopt</li>
<li><code>std</code></li>
</ul>
<a class="header" href="#clap" id="clap"><h1>CLAP</h1></a>
<p><strong>C</strong>ommand <strong>L</strong>ine <strong>A</strong>rgument <strong>P</strong>arser</p>
<ul>
<li>Usado até mesmo no Cargo e no Rustup</li>
<li>É o mais robusto de todos</li>
<li>Porém é o mais verboso</li>
<li>Várias formas de definir a interface</li>
</ul>
<p><em>(Os exemplos a seguir foram extraídos da <a href="https://docs.rs/clap">documentação oficial do CLAP</a>)</em></p>
<a class="header" href="#builder-pattern" id="builder-pattern"><h2>Builder Pattern</h2></a>
<ul>
<li>Permite configurações mais avançadas (inclusive gerar argumentos dinamicamente)</li>
<li>Muito verboso</li>
</ul>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
extern crate clap;
use clap::{Arg, App, SubCommand};

let matches = App::new(&quot;My Super Program&quot;)
                      .version(&quot;1.0&quot;)
                      .author(&quot;Kevin K. &lt;kbknapp@gmail.com&gt;&quot;)
                      .about(&quot;Does awesome things&quot;)
                      .arg(Arg::with_name(&quot;config&quot;)
                          .short(&quot;c&quot;)
                          .long(&quot;config&quot;)
                          .value_name(&quot;FILE&quot;)
                          .help(&quot;Sets a custom config file&quot;)
                          .takes_value(true))
                      .arg(Arg::with_name(&quot;INPUT&quot;)
                          .help(&quot;Sets the input file to use&quot;)
                          .required(true)
                          .index(1))
                      .arg(Arg::with_name(&quot;v&quot;)
                          .short(&quot;v&quot;)
                          .multiple(true)
                          .help(&quot;Sets the level of verbosity&quot;))
                      .subcommand(SubCommand::with_name(&quot;test&quot;)
                                  .about(&quot;controls testing features&quot;)
                                  .version(&quot;1.3&quot;)
                                  .author(&quot;Someone E. &lt;someone_else@other.com&gt;&quot;)
                                  .arg(Arg::with_name(&quot;debug&quot;)
                                      .short(&quot;d&quot;)
                                      .help(&quot;print debug information verbosely&quot;)))
                      .get_matches();
#}</code></pre></pre>
<a class="header" href="#usage-string" id="usage-string"><h2>Usage String</h2></a>
<ul>
<li>Menos verboso</li>
<li>Sacrifica alguma das configurações avançadas</li>
<li>Implica em impacto <em>muito</em> pequeno no desempenho em tempo de execução</li>
</ul>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
extern crate clap;
use clap::{Arg, App, SubCommand};

let matches = App::new(&quot;myapp&quot;)
                      .version(&quot;1.0&quot;)
                      .author(&quot;Kevin K. &lt;kbknapp@gmail.com&gt;&quot;)
                      .about(&quot;Does awesome things&quot;)
                      .args_from_usage(
                          &quot;-c, --config=[FILE] 'Sets a custom config file'
                          &lt;INPUT&gt;              'Sets the input file to use'
                          -v...                'Sets the level of verbosity'&quot;)
                      .subcommand(SubCommand::with_name(&quot;test&quot;)
                                  .about(&quot;controls testing features&quot;)
                                  .version(&quot;1.3&quot;)
                                  .author(&quot;Someone E. &lt;someone_else@other.com&gt;&quot;)
                                  .arg_from_usage(&quot;-d, --debug 'Print debug information'&quot;))
                      .get_matches();
#}</code></pre></pre>
<a class="header" href="#yaml" id="yaml"><h2>YAML</h2></a>
<ul>
<li>Mantém o código Rust mais limpo</li>
<li>Facilita a internacionalização</li>
<li>Adiciona mais dependências à crate</li>
<li>Tem um impacto um pouco maior no desempenho em tempo de execução</li>
</ul>
<pre><code class="language-yml">name: myapp
version: &quot;1.0&quot;
author: Kevin K. &lt;kbknapp@gmail.com&gt;
about: Does awesome things
args:
    - config:
        short: c
        long: config
        value_name: FILE
        help: Sets a custom config file
        takes_value: true
    - INPUT:
        help: Sets the input file to use
        required: true
        index: 1
    - verbose:
        short: v
        multiple: true
        help: Sets the level of verbosity
subcommands:
    - test:
        about: controls testing features
        version: &quot;1.3&quot;
        author: Someone E. &lt;someone_else@other.com&gt;
        args:
            - debug:
                short: d
                help: print debug information
</code></pre>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
#[macro_use]
extern crate clap;
use clap::App;

let yaml = load_yaml!(&quot;cli.yml&quot;);
let matches = App::from_yaml(yaml).get_matches();
#}</code></pre></pre>
<a class="header" href="#macro" id="macro"><h2>Macro</h2></a>
<p>Abordagem híbrida: desempenho do <em>builder pattern</em> sem o <em>boiler plate</em>.</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
#[macro_use]
extern crate clap;

let matches = clap_app!(myapp =&gt;
    (version: &quot;1.0&quot;)
    (author: &quot;Kevin K. &lt;kbknapp@gmail.com&gt;&quot;)
    (about: &quot;Does awesome things&quot;)
    (@arg CONFIG: -c --config +takes_value &quot;Sets a custom config file&quot;)
    (@arg INPUT: +required &quot;Sets the input file to use&quot;)
    (@arg debug: -d ... &quot;Sets the level of debugging information&quot;)
    (@subcommand test =&gt;
        (about: &quot;controls testing features&quot;)
        (version: &quot;1.3&quot;)
        (author: &quot;Someone E. &lt;someone_else@other.com&gt;&quot;)
        (@arg verbose: -v --verbose &quot;Print test information verbosely&quot;)
    )
).get_matches();
#}</code></pre></pre>
<a class="header" href="#extração-dos-argumentos" id="extração-dos-argumentos"><h2>Extração dos Argumentos</h2></a>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
// Extrai o valor de `config`, se passado pelo usuário, senão usa &quot;default.conf&quot;
let config = matches.value_of(&quot;config&quot;).unwrap_or(&quot;default.conf&quot;);
println!(&quot;Value for config: {}&quot;, config);

// Chamar .unwrap() é seguro aqui, porque `INPUT` é necessário.
// Se `INPUT` não fosse obrigatório, poderia-se usar um `if let` para extrair o valor condicionalmente
println!(&quot;Using input file: {}&quot;, matches.value_of(&quot;INPUT&quot;).unwrap());

// A saída varia de acordo com quantas vezes o usuário passou a flag `verbose`.
// i.e. `myprog -v -v -v` or `myprog -vvv` vs `myprog -v`
match matches.occurrences_of(&quot;v&quot;) {
    0 =&gt; println!(&quot;No verbose info&quot;),
    1 =&gt; println!(&quot;Some verbose info&quot;),
    2 =&gt; println!(&quot;Tons of verbose info&quot;),
    3 | _ =&gt; println!(&quot;Don't be crazy&quot;),
}

// ...resto da lógica da aplicação
#}</code></pre></pre>
<pre><code class="language-shell">$ myprog --help
My Super Program 1.0
Kevin K. &lt;kbknapp@gmail.com&gt;
Does awesome things

USAGE:
    MyApp [FLAGS] [OPTIONS] &lt;INPUT&gt; [SUBCOMMAND]

FLAGS:
    -h, --help       Prints this message
    -v               Sets the level of verbosity
    -V, --version    Prints version information

OPTIONS:
    -c, --config &lt;FILE&gt;    Sets a custom config file

ARGS:
    INPUT    The input file to use

SUBCOMMANDS:
    help    Prints this message
    test    Controls testing features
</code></pre>
<a class="header" href="#structopt" id="structopt"><h1>StructOpt</h1></a>
<ul>
<li>Usa macros pra gerar código que usa CLAP</li>
<li>Expõe os argumentos recebidos como uma struct normal</li>
<li>(é o meu preferido)</li>
</ul>
<a class="header" href="#struct" id="struct"><h2>Struct</h2></a>
<pre><pre class="playpen"><code class="language-rust">#[macro_use]
extern crate structopt;
use structopt::StructOpt;

use std::path::PathBuf;

#[derive(StructOpt, Debug)]
#[structopt(name = &quot;example&quot;, about = &quot;An example of StructOpt usage.&quot;)]
struct Opt {

    /// Activate debug mode
    #[structopt(short = &quot;d&quot;, long = &quot;debug&quot;)]
    debug: bool,

    /// Set speed
    #[structopt(short = &quot;s&quot;, long = &quot;speed&quot;, default_value = &quot;42&quot;)]
    speed: f64,

    /// Input file
    #[structopt(parse(from_os_str))]
    input: PathBuf,

    /// Output file, stdout if not present
    #[structopt(parse(from_os_str))]
    output: Option&lt;PathBuf&gt;,

}

fn main() {
    let opt = Opt::from_args();
    println!(&quot;{:?}&quot;, opt);
}
</code></pre></pre>
<a class="header" href="#enum" id="enum"><h2>Enum</h2></a>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
#[derive(StructOpt)]
#[structopt(name = &quot;git&quot;, about = &quot;the stupid content tracker&quot;)]
enum Git {

    #[structopt(name = &quot;add&quot;)]
    Add {
        #[structopt(short = &quot;i&quot;)]
        interactive: bool,

        #[structopt(short = &quot;p&quot;)]
        patch: bool,

        #[structopt(parse(from_os_str))]
        files: Vec&lt;PathBuf&gt;
    },

    #[structopt(name = &quot;fetch&quot;)]
    Fetch {
        #[structopt(long = &quot;dry-run&quot;)]
        dry_run: bool,

        #[structopt(long = &quot;all&quot;)]
        all: bool,

        repository: Option&lt;String&gt;
    },

    #[structopt(name = &quot;commit&quot;)]
    Commit {
        #[structopt(short = &quot;m&quot;)]
        message: Option&lt;String&gt;,

        #[structopt(short = &quot;a&quot;)]
        all: bool
    }

}
#}</code></pre></pre>
<a class="header" href="#thunder" id="thunder"><h1>Thunder</h1></a>
<ul>
<li>Também usa macros pra gerar código que usa CLAP</li>
<li>Expõe métodos como subcomandos</li>
<li>Os argumentos são criados a partir dos parâmetros</li>
</ul>
<pre><pre class="playpen"><code class="language-rust">struct MyApp;

#[thunderclap]
impl MyApp {
    /// Say hello to someone on the other side
    fn say_hello(name: &amp;str, age: Option&lt;u16&gt;) { /* ... */ }

    /// It was nice to meet you!
    fn goodybe(name: Option&lt;&amp;str&gt;) { /* ... */ }
}

fn main() {
    MyApp::start();
}
</code></pre></pre>
<a class="header" href="#docopt" id="docopt"><h1>Docopt</h1></a>
<ul>
<li>Biblioteca disponível em várias linguagens, originalmente criada para Python</li>
<li>A interface é definida a partir da string que a documenta</li>
</ul>
<pre><pre class="playpen"><code class="language-rust">#[macro_use]
extern crate serde_derive;

extern crate docopt;
use docopt::Docopt;

const USAGE: &amp;'static str = &quot;
Naval Fate.

Usage:
  naval_fate.py ship new &lt;name&gt;...
  naval_fate.py ship &lt;name&gt; move &lt;x&gt; &lt;y&gt; [--speed=&lt;kn&gt;]
  naval_fate.py ship shoot &lt;x&gt; &lt;y&gt;
  naval_fate.py mine (set|remove) &lt;x&gt; &lt;y&gt; [--moored | --drifting]
  naval_fate.py (-h | --help)
  naval_fate.py --version

Options:
  -h --help     Show this screen.
  --version     Show version.
  --speed=&lt;kn&gt;  Speed in knots [default: 10].
  --moored      Moored (anchored) mine.
  --drifting    Drifting mine.
&quot;;

#[derive(Debug, Deserialize)]
struct Args {
    flag_speed: isize,
    flag_drifting: bool,
    arg_name: Vec&lt;String&gt;,
    arg_x: Option&lt;i32&gt;,
    arg_y: Option&lt;i32&gt;,
    cmd_ship: bool,
    cmd_mine: bool,
}

fn main() {
    let args: Args = Docopt::new(USAGE)
                            .and_then(|d| d.deserialize())
                            .unwrap_or_else(|e| e.exit());
    println!(&quot;{:?}&quot;, args);
}
</code></pre></pre>
<a class="header" href="#std" id="std"><h1>std</h1></a>
<ul>
<li>Para tarefas simples, ferramentas simples</li>
</ul>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
use std::env;

for argument in env::args() {
    println!(&quot;{}&quot;, argument);
}

for (key, value) in env::vars() {
    println!(&quot;{}: {}&quot;, key, value);
}

let key = &quot;HOME&quot;;
match env::var(key) {
    Ok(val) =&gt; println!(&quot;{}: {:?}&quot;, key, val),
    Err(e) =&gt; println!(&quot;couldn't interpret {}: {}&quot;, key, e),
}
#}</code></pre></pre>
<a class="header" href="#tratamento-de-erros" id="tratamento-de-erros"><h1>Tratamento de Erros</h1></a>
<p><img src="https://raw.githubusercontent.com/rochacbruno/rust_memes/master/img/dontpanic.jpg" width="250px"/></p>
<a class="header" href="#unwrapexpect" id="unwrapexpect"><h2><code>unwrap</code>/<code>expect</code></h2></a>
<pre><pre class="playpen"><code class="language-rust">use std::fs;

fn main() {
    let contents = fs::read_to_string(&quot;file.txt&quot;);
    println!(&quot;{}&quot;, contents.unwrap());
}
</code></pre></pre>
<pre><code class="language-shell">thread 'main' panicked at 'called `Result::unwrap()` on an `Err` value: Os { code: 2, kind: NotFound, message: &quot;No such file or directory&quot; }', libcore/result.rs:945:5
note: Run with `RUST_BACKTRACE=1` for a backtrace.
</code></pre>
<ul>
<li><code>unwrap</code> deve ser usado com <strong>muita</strong> moderação.</li>
<li>Se for usar, prefira sempre <code>expect</code>.</li>
<li>Idealmente, deixe um comentário justificando o uso.</li>
</ul>
<a class="header" href="#a-no-main" id="a-no-main"><h2><code>?</code> no <code>main</code></h2></a>
<ul>
<li><code>main</code> pode retornar <code>Return&lt;(), E: Debug&gt;</code></li>
<li><code>?</code> pode ser usado como <code>unwrap</code>/<code>early return</code> em funções que retornam <code>Option</code> ou <code>Result</code></li>
</ul>
<pre><pre class="playpen"><code class="language-rust">use std::{fs, io};

fn main() -&gt; Result&lt;(), io::Error&gt; {
    let contents = fs::read_to_string(&quot;file.txt&quot;);
    println!(&quot;{}&quot;, contents?);

    Ok(())
}
</code></pre></pre>
<pre><code class="language-shell">Error: Os { code: 2, kind: NotFound, message: &quot;No such file or directory&quot; }
</code></pre>
<a class="header" href="#lidando-com-vários-tipos-de-erros" id="lidando-com-vários-tipos-de-erros"><h2>Lidando com vários tipos de erros</h2></a>
<pre><pre class="playpen"><code class="language-rust">use std::{error::Error, fs};

fn main() -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt; {
    let contents = fs::read_to_string(&quot;file.txt&quot;);
    println!(&quot;{}&quot;, contents?);

    Ok(())
}
</code></pre></pre>
<pre><code class="language-shell">Error: Os { code: 2, kind: NotFound, message: &quot;No such file or directory&quot; }
</code></pre>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
pub trait Error: Debug + Display {
    fn description(&amp;self) -&gt; &amp;str { ... }
    fn cause(&amp;self) -&gt; Option&lt;&amp;Error&gt; { ... }
}
#}</code></pre></pre>
<a class="header" href="#failure" id="failure"><h2>Failure</h2></a>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
extern crate failure;
#[macro_use] extern crate failure_derive;

use std::fmt

#[derive(Fail, Debug)]
struct MyError {
    code: i32,
    message: String,
}

impl fmt::Display for MyError {
    fn fmt(&amp;self, f: &amp;mut fmt::Formatter) -&gt; fmt::Result {
        write!(f, &quot;An error occurred with error code {}. ({})&quot;, self.code, self.message)
    }
}
#}</code></pre></pre>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
extern crate failure;
#[macro_use] extern crate failure_derive;

#[derive(Fail, Debug)]
#[fail(display = &quot;An error occurred with error code {}. ({})&quot;, code, message)]
struct MyError {
    code: i32,
    message: String,
}
#}</code></pre></pre>
<pre><pre class="playpen"><code class="language-rust">extern crate failure;

use std::fs;

fn main() -&gt; Result&lt;(), failure::Error&gt; {
    let contents = fs::read_to_string(&quot;file.txt&quot;);
    println!(&quot;{}&quot;, contents?);

    Ok(())
}
</code></pre></pre>
<pre><code class="language-shell">Error: Os { code: 2, kind: NotFound, message: &quot;No such file or directory&quot; }
</code></pre>
<a class="header" href="#exitfailure" id="exitfailure"><h2>ExitFailure</h2></a>
<pre><pre class="playpen"><code class="language-rust">extern crate failure;

extern crate exitfailure;
use exitfailure::ExitFailure;

use std::{env, fs, io};

fn main() -&gt; Result&lt;(), ExitFailure&gt; {
    let contents = fs::read_to_string(&quot;file.txt&quot;);
    println!(&quot;{}&quot;, contents?);

    Ok(())
}
</code></pre></pre>
<pre><code class="language-shell">Error: No such file or directory (os error 2)
</code></pre>
<a class="header" href="#human-panic" id="human-panic"><h2>human-panic</h2></a>
<p>Se tudo falhar...</p>
<pre><pre class="playpen"><code class="language-rust">#[macro_use]
extern crate human_panic;

fn main() {
   setup_panic!();

   println!(&quot;A normal log message&quot;);
   panic!(&quot;OMG EVERYTHING IS ON FIRE!!!&quot;)
}
</code></pre></pre>
<p>Sem <code>human-panic</code></p>
<pre><code class="language-shell">thread 'main' panicked at 'OMG EVERYTHING IS ON FIRE!!!', examples/main.rs:2:3
note: Run with `RUST_BACKTRACE=1` for a backtrace.
</code></pre>
<p><strong>Com</strong> <code>human-panic</code></p>
<pre><code>Well, this is embarrassing.

human-panic had a problem and crashed.
To help us diagnose the problem you can send us a crash report.

We have generated a report file at &quot;/var/folders/zw/bpfvmq390lv2c6gn_6byyv0w0000gn/T/report-8351cad6-d2b5-4fe8-accd-1fcbf4538792.toml&quot;.
Submit an issue or email with the subject of &quot;human-panic Crash Report&quot; and include the report as an attachment.

- Homepage: https://github.com/yoshuawuyts/human-panic
- Authors: Yoshua Wuyts &lt;yoshuawuyts@gmail.com&gt;

We take privacy seriously, and do not perform any automated error collection.
In order to improve the software, we rely on people to submit reports.

Thank you kindly!
</code></pre>
<a class="header" href="#testes" id="testes"><h1>Testes</h1></a>
<a class="header" href="#assert_cmd" id="assert_cmd"><h2>assert_cmd</h2></a>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
extern crate assert_cmd;

use std::process::Command;
use assert_cmd::prelude::*;

Command::main_binary()
    .unwrap()
    .assert()
    .success();
#}</code></pre></pre>
<a class="header" href="#rexpect" id="rexpect"><h2>rexpect</h2></a>
<pre><pre class="playpen"><code class="language-rust">extern crate rexpect;

use rexpect::spawn;
use rexpect::errors::*;

fn do_ftp() -&gt; Result&lt;()&gt; {
    let mut p = spawn(&quot;ftp speedtest.tele2.net&quot;, Some(30_000))?;
    p.exp_regex(&quot;Name \\(.*\\):&quot;)?;
    p.send_line(&quot;anonymous&quot;)?;
    p.exp_string(&quot;Password&quot;)?;
    p.send_line(&quot;test&quot;)?;
    p.exp_string(&quot;ftp&gt;&quot;)?;
    p.send_line(&quot;cd upload&quot;)?;
    p.exp_string(&quot;successfully changed.\r\nftp&gt;&quot;)?;
    p.send_line(&quot;pwd&quot;)?;
    p.exp_regex(&quot;[0-9]+ \&quot;/upload\&quot;&quot;)?;
    p.send_line(&quot;exit&quot;)?;
    p.exp_eof()?;
    Ok(())
}


fn main() {
    do_ftp().unwrap_or_else(|e| panic!(&quot;ftp job failed with {}&quot;, e));
}
</code></pre></pre>
<a class="header" href="#empacotamento" id="empacotamento"><h1>Empacotamento</h1></a>
<p><img src="https://raw.githubusercontent.com/rochacbruno/rust_memes/master/img/crates.jpg" width="250px"/></p>
<a class="header" href="#cargo" id="cargo"><h1>Cargo</h1></a>
<pre><code class="language-shell">~ $ cargo new foo
     Created binary (application) `foo` project

~ $ exa -T foo
foo
├── Cargo.toml
└── src
   └── main.rs
</code></pre>
<pre><code class="language-toml">[package]
name = &quot;foo&quot;
version = &quot;0.1.0&quot;
authors = [&quot;Cauê Baasch de Souza &lt;cauebs@pm.me&gt;&quot;]

[dependencies]
</code></pre>
<pre><code class="language-shell">~/foo $ cargo run
   Compiling foo v0.1.0 (file:///home/cauebs/foo)
    Finished dev [unoptimized + debuginfo] target(s) in 0.39s
     Running `target/debug/foo`
Hello, world!
</code></pre>
<pre><code class="language-shell">~/foo $ cargo publish
</code></pre>
<pre><code class="language-shell">~ $ cargo install foo
</code></pre>
<a class="header" href="#compilação-cruzada" id="compilação-cruzada"><h1>Compilação Cruzada</h1></a>
<pre><code class="language-shell">~ $ rustup target add x86_64-unknown-linux-musl
</code></pre>
<pre><code class="language-shell">~/foo $ cargo build --target x86_64-unknown-linux-musl
</code></pre>
<a class="header" href="#a-hrefhttpsgithubcomjapariccrossgithubcomjapariccrossa" id="a-hrefhttpsgithubcomjapariccrossgithubcomjapariccrossa"><h2><a href="https://github.com/japaric/cross">github.com/japaric/cross</a></h2></a>
<a class="header" href="#ci-a-hrefhttpsgithubcomjaparictrustgithubcomjaparictrusta-travis--appveyor" id="ci-a-hrefhttpsgithubcomjaparictrustgithubcomjaparictrusta-travis--appveyor"><h2>CI: <a href="https://github.com/japaric/trust">github.com/japaric/trust</a> (Travis + AppVeyor)</h2></a>
<a class="header" href="#geração-de-pacotes" id="geração-de-pacotes"><h1>Geração de Pacotes</h1></a>
<ul>
<li>cargo-deb</li>
<li>cargo-rpm</li>
<li>cargo-pkgbuild</li>
<li>cargo-ebuild</li>
<li>cargo-wix</li>
</ul>
<a class="header" href="#documentação" id="documentação"><h1>Documentação</h1></a>
<a class="header" href="#geração-de-manpages" id="geração-de-manpages"><h2>Geração de manpages</h2></a>
<p><a href="https://github.com/rust-clique/man">github.com/rust-clique/man</a></p>
<a class="header" href="#edição-do-readme" id="edição-do-readme"><h2>Edição do README</h2></a>
<p><a href="https://github.com/yoshuawuyts/markdown-edit">github.com/yoshuawuyts/markdown-edit</a></p>
<a class="header" href="#exemplos-de-sucesso" id="exemplos-de-sucesso"><h1>Exemplos de sucesso</h1></a>
<a class="header" href="#a-hrefhttpsgithubcomoghamexagithubcomoghamexaa" id="a-hrefhttpsgithubcomoghamexagithubcomoghamexaa"><h1><a href="https://github.com/ogham/exa">github.com/ogham/exa</a></h1></a>
<p><img src="https://raw.githubusercontent.com/ogham/exa/master/screenshots.png" alt="exa" /></p>
<a class="header" href="#a-hrefhttpsgithubcomburntsushiripgrepgithubcomburntsushiripgrepa" id="a-hrefhttpsgithubcomburntsushiripgrepgithubcomburntsushiripgrepa"><h1><a href="https://github.com/BurntSushi/ripgrep">github.com/BurntSushi/ripgrep</a></h1></a>
<p><img src="https://camo.githubusercontent.com/a750be5009f196be6158976afd5bc53356f9273d/687474703a2f2f6275726e7473757368692e6e65742f73747566662f72697067726570312e706e67" alt="rg" /></p>
<p><img src="exemplos/rg.png" alt="bench" /></p>
<a class="header" href="#a-hrefhttpsgithubcomsharkdpfdgithubcomsharkdpfda" id="a-hrefhttpsgithubcomsharkdpfdgithubcomsharkdpfda"><h1><a href="https://github.com/sharkdp/fd">github.com/sharkdp/fd</a></h1></a>
<p><img src="https://raw.githubusercontent.com/sharkdp/fd/master/doc/screencast.svg?sanitize=true" alt="fd" /></p>
<pre><code class="language-shell">
</code></pre>
<a class="header" href="#a-hrefhttpsgithubcomsharkdpbatgithubcomsharkdpbata" id="a-hrefhttpsgithubcomsharkdpbatgithubcomsharkdpbata"><h1><a href="https://github.com/sharkdp/bat">github.com/sharkdp/bat</a></h1></a>
<p><img src="https://camo.githubusercontent.com/9d3d89364f2cc83ace8f29646a6236bc15ea1da0/68747470733a2f2f696d6775722e636f6d2f724773646e44652e706e67" alt="bat" /></p>
<a class="header" href="#a-hrefhttpsgithubcomaaronepowertokeigithubcomaaronepowertokeia" id="a-hrefhttpsgithubcomaaronepowertokeigithubcomaaronepowertokeia"><h1><a href="https://github.com/Aaronepower/tokei">github.com/Aaronepower/tokei</a></h1></a>
<pre><code class="language-shell">~/durt $ tokei
----------------------------------------------------------
 Language    Files    Lines    Code    Comments    Blanks
----------------------------------------------------------
 Markdown        1       47      47           0         0
 Rust            1      164     123          11        30
 TOML            1       18      15           0         3
----------------------------------------------------------
 Total           3      229     185          11        33
----------------------------------------------------------

</code></pre>
<a class="header" href="#a-hrefhttpsgithubcomsharkdphyperfinegithubcomsharkdphyperfinea" id="a-hrefhttpsgithubcomsharkdphyperfinegithubcomsharkdphyperfinea"><h1><a href="https://github.com/sharkdp/hyperfine">github.com/sharkdp/hyperfine</a></h1></a>
<p><img src="https://camo.githubusercontent.com/90d33a6e34fc741fc6491c1f5b70067e2d105e1b/68747470733a2f2f692e696d6775722e636f6d2f354f71724757652e676966" alt="hyperfine" /></p>
<a class="header" href="#a-hrefhttpsgithubcomcauebsdurtgithubcomcauebsdurta" id="a-hrefhttpsgithubcomcauebsdurtgithubcomcauebsdurta"><h1><a href="https://github.com/cauebs/durt">github.com/cauebs/durt</a></h1></a>
<pre><code class="language-shell">~/durt $ durt --sort --total --percentage *
     499 B  ( 0.49%)  Cargo.toml
   1.26 kB  ( 1.23%)  README.md
   9.87 kB  ( 9.67%)  Cargo.lock
  35.15 kB  (34.43%)  LICENSE
  55.30 kB  (54.17%)  src
 ---------
 102.08 kB
</code></pre>
<p><em>(Todo feedback é bem vindo!)</em></p>
<a class="header" href="#obrigado-pela-atenção" id="obrigado-pela-atenção"><h1>Obrigado pela atenção!</h1></a>
<ul>
<li>Telegram: <a href="https://t.me/cauebs">@cauebs</a></li>
<li>Github: <a href="https://github.com/cauebs">@cauebs</a></li>
<li><strong>Perguntas?</strong></li>
</ul>
<p><img src="https://raw.githubusercontent.com/rochacbruno/rust_memes/master/img/ferris_happy.jpg" width="200px"/></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
